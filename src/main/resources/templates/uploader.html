<!DOCTYPE html>

<!--/* Note the xmlns:* here are completely optional and only meant to     */-->
<!--/* avoid IDEs from complaining about tags/attributes they may not know */-->
<html xmlns:th="http://www.thymeleaf.org" xmlns:score="http://thymeleafexamples">

<head>
    <title>文件导入</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

    <link href="/static/css/bootstrap.min.css"
          rel="stylesheet" type="text/css" />
    <link href="/static/css/font-awesome.min.css"
          rel="stylesheet" type="text/css" />
    <link href="/static/css/bootstrap-table.css"
          rel="stylesheet" type="text/css" />
    <script type="application/javascript" src="/static/js/jquery.min.js"></script>
    <script type="application/javascript" src="/static/js/bootstrap_table/bootstrap-table.js"></script>
    <script type="application/javascript" src="/static/js/bootstrap_table/locale/bootstrap-table-zh-CN.js"></script>
</head>

<body>
    <div class="container-fluid" style="margin-top: 40px;">
        <div class="row">
            <div class="col-sm-4">
                <form class="form-horizontal" method="POST" action="/upload" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="table" class="col-sm-2 control-label">表名</label>
                        <div class="col-sm-5">
                            <input type="text" class="form-control" id="table" name="table" placeholder="表名" />
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-5">
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" name="validateIDCard" id="validateIDCard" value="true"/> 开启身份证验证
                                </label>
                            </div>
                        </div>
                    </div>
                    <div id="idcardColumnsForm" class="form-group" for="validateIDCard" style="display: none;">
                        <label for="idcardColumns" class="col-sm-2 control-label">身份证列号</label>
                        <div class="col-sm-5">
                            <input type="text" class="form-control" name="idcardColumns" id="idcardColumns" placeholder="身份证列号" />
                            <span id="helpBlock2" class="help-block">以1位起始序列,多个列以逗号进行分隔</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="exampleInputFile" class="col-sm-2 control-label">上传文件</label>
                        <div class="col-sm-5">
                            <input type="file" name="file" multiple="multiple" id="exampleInputFile"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            <button type="submit" class="btn btn-default">Submit</button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="col-sm-8">
                <h4>导入历史记录</h4>
                <div class="table-responsive" id="static_table" style="margin-top: 10px;min-height:540px;">
                    <table id="his_table">
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!--<form method="POST" action="/upload" enctype="multipart/form-data">
        <label>表名:</label><input type="text" name="table"/>
        <input type="file" name="file" multiple="multiple"/><br/><br/>
        <input type="submit" value="Submit" />
    </form>-->

</body>

<script th:inline="javascript">
    /*<![CDATA[*/
    $(function(){
        var $idcardColumnsForm = $('#idcardColumnsForm'),
            $table = $('#his_table');
        $('#validateIDCard').click(function(){
            if(this.checked){
                $idcardColumnsForm.show();
            }else{
                $idcardColumnsForm.hide();
            }
        });

        initTable();

        function initTable(){
            $table.bootstrapTable({
                height: 500,
                url: '/fileImportInfos',
                sidePagination: "server",
                dataType: "json",
                /*  silentSort: true, */
                cache: false,
                sortName: 'factory_id',
                pagination: true,
                pageSize: 10,
                pageList: [10,20,50],
                /* sortSide: 'client', */
                queryParams: function(params){
                    return params;
                },
                columns: [
                    {
                        title: '序号',
                        field: 'state',
                        align: 'center',
                        valign: 'middle',
                        width:'50',
                        formatter: function operateFormatter(value, row, index) {
                            var options = $table.bootstrapTable('getOptions');
                            var page = options.pageNumber,
                                perRows = options.pageSize;
                            return (page - 1) * perRows + index + 1;
                        }
                    }, {
                        title: '表名',
                        field: 'tableName',
                        align: 'center',
                        valign: 'middle',
                        width: '100'
                    },{
                        title: '文件名',
                        field: 'fileName',
                        align: 'center',
                        valign: 'middle',
                        width:'100'
                    },{
                        title: '导入时间',
                        field: 'jobStartTime',
                        align: 'center',
                        valign: 'middle',
                        width:'100',
                        formatter: function (value, row, index) {
                            return formatMill(value,'yyyy-MM-dd hh:mm:ss');
                        }
                    },{
                        title: '导入结束时间',
                        field: 'jobEndTime',
                        align: 'center',
                        valign: 'middle',
                        width:'100',
                        formatter: function (value, row, index) {
                            return formatMill(value,'yyyy-MM-dd hh:mm:ss');
                        }
                    },{
                        title: '读取数',
                        field: 'readCount',
                        align: 'center',
                        valign: 'middle',
                        width:'50',
                        formatter: function (value, row, index) {
                            return formatNum(value);
                        }
                    },
                    {
                        title: '写入数',
                        field: 'writeCount',
                        align: 'center',
                        valign: 'middle',
                        width:'50',
                        formatter: function (value, row, index) {
                            return formatNum(value);
                        }
                    },{
                        title: '过滤数',
                        field: 'filterCount',
                        align: 'center',
                        valign: 'middle',
                        width:'50',
                        formatter: function (value, row, index) {
                            return formatNum(value);
                        }
                    }
                ]
            }).on('sort.bs.table', function (name,order) {
                //console.log('sortinfo:' + name + ',' + order);
            }).on('post-body.bs.table',function(){

            }).on('load-success.bs.table',function(data){

            });
        }

        function formatNum(num){
            return num == null ? '-' : num;
        }

        function formatMill(mill,pattern){
            if(!mill){
                return '-';
            }

            var date = new Date();
            date.setTime(mill);

            return date.Format(pattern);
        }


    });

    // 对Date的扩展，将 Date 转化为指定格式的String
    // 月(M)、日(d)、小时(h)、分(m)、秒(s)、季度(q) 可以用 1-2 个占位符，
    // 年(y)可以用 1-4 个占位符，毫秒(S)只能用 1 个占位符(是 1-3 位的数字)
    // 例子：
    // (new Date()).Format("yyyy-MM-dd hh:mm:ss.S") ==> 2006-07-02 08:09:04.423
    // (new Date()).Format("yyyy-M-d h:m:s.S") ==> 2006-7-2 8:9:4.18
    Date.prototype.Format = function(fmt) { // author: meizz
        var o = {
            "M+" : this.getMonth() + 1, // 月份
            "d+" : this.getDate(), // 日
            "h+" : this.getHours(), // 小时
            "m+" : this.getMinutes(), // 分
            "s+" : this.getSeconds(), // 秒
            "q+" : Math.floor((this.getMonth() + 3) / 3), // 季度
            "S" : this.getMilliseconds() // 毫秒
        };
        if (/(y+)/.test(fmt))
            fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for ( var k in o)
            if (new RegExp("(" + k + ")").test(fmt))
                fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    };

    /*]]>*/
</script>

</html>